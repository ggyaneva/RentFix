<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Owner Dashboard - RentFix</title>
    <th:block th:replace="~{fragments/header :: head}"></th:block>
</head>

<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="page-content">
    <div class="container">

        <!-- HEADER -->
        <div class="page-header">
            <h1>Your Properties</h1>
            <p class="text-secondary">Manage your properties, tenants, payments and maintenance.</p>
        </div>

        <!-- TOP BUTTONS -->
        <div class="page-section" style="display:flex; gap:1rem; margin-bottom:2rem;">

            <a class="btn btn-primary" th:href="@{/properties/owner/create}">
                + Add New Property
            </a>

            <a class="btn btn-secondary" th:href="@{/owner/maintenance}">
                Maintenance
            </a>
        </div>

        <!-- TABLE -->
        <div class="table-responsive">
            <table class="table">
                <thead>
                <tr>
                    <th>Property</th>
                    <th>City</th>
                    <th>Rent (â‚¬)</th>
                    <th>Status</th>
                    <th>Maintenance</th>
                    <th>Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${properties}">

                    <!-- Property / City / Rent -->
                    <td th:text="${p.title}"></td>
                    <td th:text="${p.city}"></td>
                    <td th:text="${p.monthlyRent}"></td>

                    <!-- Status -->
                    <td>
                        <span class="badge badge-available"
                              th:if="${p.status.name() == 'AVAILABLE'}">AVAILABLE</span>

                        <span class="badge badge-rented"
                              th:if="${p.status.name() == 'RENTED'}">RENTED</span>
                    </td>

                    <td><span class="circle-gold" th:text="${maintenanceCountMap[p.id] != null ? maintenanceCountMap[p.id] : 0}"></span></td>


                    <!-- ACTIONS -->
                    <td class="actions-cell center-actions">
                        <div class="actions-wrapper">

                            <a class="btn btn-sm btn-primary"
                               th:href="@{/owner/property/{id}/payments(id=${p.id})}">
                                Payments
                            </a>

                            <a class="btn btn-sm btn-primary"
                               th:href="@{/owner/property/{id}/contracts(id=${p.id})}">
                                Contracts
                            </a>

                            <a class="btn btn-sm btn-warning"
                               th:href="@{/properties/owner/edit/{id}(id=${p.id})}">
                                Edit
                            </a>

                            <form th:action="@{/properties/owner/delete/{id}(id=${p.id})}"
                                  method="post"
                                  style="display:inline-block;">

                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                                <button class="btn btn-sm btn-danger" type="submit">Delete</button>

                            </form>

                        </div>
                    </td>

                </tr>
                </tbody>

            </table>
        </div>

    </div>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>
</body>
</html>
