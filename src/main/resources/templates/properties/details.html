<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en">
<head>
    <title th:text="${property.title} + ' - RentFix'">Property Details</title>
    <th:block th:replace="~{fragments/header :: head}"></th:block>
</head>

<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="page-content">
    <div class="container">

        <div th:if="${error}" class="alert alert-danger" style="margin-bottom:2rem;">
            <p th:text="${error}"></p>
        </div>

        <div class="page-header">
            <h1 th:text="${property.title}"></h1>
            <p class="text-secondary" th:text="${property.city}"></p>
        </div>

        <!-- GALLERY -->
        <div class="details-gallery" th:if="${property.imageUrls != null}">

            <div class="main-image-wrapper">
                <img id="main-image"
                     th:src="${property.imageUrls[0]}"
                     class="main-image"
                     alt="Property Image">
            </div>

            <div class="thumbnail-row">
                <img th:each="img : ${property.imageUrls}"
                     th:src="${img}"
                     class="thumbnail-image"
                     onclick="document.getElementById('main-image').src = this.src;" >
            </div>

        </div>

        <div class="details-layout">

            <!-- LEFT CONTENT -->
            <div class="details-main card">
                <h3 class="card-title">Property Information</h3>

                <div class="details-grid">

                    <div><p class="text-secondary mb-1"><strong>City:</strong></p>
                        <p th:text="${property.city}"></p></div>

                    <div><p class="text-secondary mb-1"><strong>Address:</strong></p>
                        <p th:text="${property.address}"></p></div>

                    <div><p class="text-secondary mb-1"><strong>Bedrooms:</strong></p>
                        <p th:text="${property.bedrooms}"></p></div>

                    <div><p class="text-secondary mb-1"><strong>Bathrooms:</strong></p>
                        <p th:text="${property.bathrooms}"></p></div>

                    <div><p class="text-secondary mb-1"><strong>Area:</strong></p>
                        <p th:text="${property.areaSqm} + ' sqm'"></p></div>

                    <div><p class="text-secondary mb-1"><strong>Monthly Rent:</strong></p>
                        <p th:text="${property.monthlyRent} + ' €'"></p></div>
                    <div>
                        <p class="text-secondary mb-1"><strong>Owner:</strong></p>
                        <p th:text="${property.owner.firstName + ' ' + property.owner.lastName}"></p>
                    </div>

                    <div>
                        <p class="text-secondary mb-1"><strong>Owner Phone:</strong></p>
                        <p th:text="${property.owner.phoneNumber}"></p>
                    </div>


                </div>

                <div th:if="${property.description != null && !property.description.isEmpty()}"
                     class="details-description">
                    <p class="text-secondary mb-1"><strong>Description:</strong></p>
                    <p th:text="${property.description}"></p>
                </div>
            </div>

            <!-- RIGHT RENT BOX (TENANT ONLY) -->
            <div class="details-sidebar card">

                <div class="rent-box" sec:authorize="hasRole('TENANT')">

                    <h4 class="card-title">Rent This Property</h4>
                    <p class="text-secondary mb-3">Create a rental contract and move in.</p>

                    <!-- IF TENANT ALREADY HAS A CONTRACT -->
                    <button class="btn btn-secondary w-100"
                            th:if="${hasActiveContract}"
                            disabled>
                        You already have an active contract
                    </button>

                    <!-- IF AVAILABLE AND TENANT CAN RENT -->
                    <label for="rent-modal-toggle"
                           class="btn btn-primary w-100"
                           th:if="${property.status.name() == 'AVAILABLE' and !hasActiveContract}">
                        Create Rental Contract
                    </label>

                </div>
            </div>

        </div>
    </div>
</div>



<input type="checkbox" id="rent-modal-toggle" class="modal-toggle">

<div class="modal-overlay">
    <div class="modal-box">

        <h2>Confirm Rent</h2>

        <p>
            Initial Rent: <strong th:text="${property.monthlyRent} + ' €'"></strong><br>
            Deposit: <strong th:text="${property.monthlyRent} + ' €'"></strong><br>
            Total: <strong th:text="${property.monthlyRent * 2} + ' €'"></strong>
        </p>

        <div class="modal-actions">

            <!-- CLOSE MODAL -->
            <label for="rent-modal-toggle" class="btn btn-outline-light">
                Cancel
            </label>

            <!-- CONFIRM CONTRACT CREATION -->
            <form th:action="@{/contracts/create/{id}(id=${property.id})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-primary" type="submit">Confirm & Pay</button>
            </form>
        </div>

    </div>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>

</body>
</html>
